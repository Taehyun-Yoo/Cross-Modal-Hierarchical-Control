library(data.table)
library(readxl)
library("tidyverse")
library('here')
library("grid")
library("rstatix")
library("ggplot2")
library("ggpubr")
library("MBESS")
library(ggprism)
library(svglite)
data_dir <- here("data")
total_sub_num <- 53
sub <- sprintf("%02d", 1:total_sub_num)
#No data
exc_sub <- c("13", "20", "29", "38", "39", "47", "50")
sub <- setdiff(sub, exc_sub)
sub_num <- length(sub)
hier_num = 3
hier <- c("R", "F", "D")
data_total <- data.frame()
for (s in 1:sub_num){
data_R <- read_excel(paste0(data_dir, '/', sub[s], '/', 'data', sub[s], '_R.xlsx'))
data_F <- read_excel(paste0(data_dir, '/', sub[s], '/', 'data', sub[s], '_F.xlsx'))
data_D <- read_excel(paste0(data_dir, '/', sub[s], '/', 'data', sub[s], '_D.xlsx'))
data_R$sheet = 1
data_F$sheet = 2
data_D$sheet = 3
data_RFD <- rbind(data_R, data_F, data_D)
subtmp1=subset(data_RFD,sheet==1, select = c(Subject, Onset, Code, Acc))
subtmp1 = subtmp1 %>% filter(Code != 99)
sub_R <- as.data.table(subtmp1)
sub_R[, inter_RT :=   Onset - shift(Onset, fill=last(Onset))]
RT=subset(sub_R, select = c(inter_RT))
RT <- RT[-1,]
sub_R <- head(sub_R, -1)
sub_R[, RT :=  RT]
t = as.numeric(substr(sub_R$Code, 9,11))
sub_R[, trial_number :=  t]
for (i in 1:64){
sub_R$condition[sub_R$trial_number == i] = "R1"
}
subset_R1 <- subset(sub_R, sub_R$condition == "R1")
subset_R1 <- as.data.frame(subset_R1)
subset_R1['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_R1['Hier'] <- c(rep("R", times = 64))
subset_R1['Comp'] <- c(rep("1", times = 64))
subset_R1['Condition'] <- c(rep("R1", times = 64))
for (i in 65:128){
sub_R$condition[sub_R$trial_number == i] = "R2"
}
subset_R2 <- subset(sub_R, sub_R$condition == "R2")
subset_R2 <- as.data.frame(subset_R2)
subset_R2['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_R2['Hier'] <- c(rep("R", times = 64))
subset_R2['Comp'] <- c(rep("2", times = 64))
subset_R2['Condition'] <- c(rep("R2", times = 64))
for (i in 129:192){
sub_R$condition[sub_R$trial_number == i] = "R4"
}
subset_R4 <- subset(sub_R, sub_R$condition == "R4")
subset_R4 <- as.data.frame(subset_R4)
subset_R4['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_R4['Hier'] <- c(rep("R", times = 64))
subset_R4['Comp'] <- c(rep("4", times = 64))
subset_R4['Condition'] <- c(rep("R4", times = 64))
subset_R <- rbind(subset_R1, subset_R2, subset_R4)
subtmp2=subset(data_RFD,sheet==2, select = c(Subject, Onset, Code, Acc))
subtmp2 = subtmp2 %>% filter(Code != 99)
sub_F <- as.data.table(subtmp2)
sub_F[, inter_RT :=   Onset - shift(Onset, fill=last(Onset))]
RT=subset(sub_F, select = c(inter_RT))
RT <- RT[-1,]
sub_F <- head(sub_F, -1)
sub_F[, RT :=  RT]
t = as.numeric(substr(sub_F$Code, 9,11))
sub_F[, trial_number :=  t]
for (i in 1:64){
sub_F$condition[sub_F$trial_number == i] = "F1"
}
subset_F1 <- subset(sub_F, sub_F$condition == "F1")
subset_F1 <- as.data.frame(subset_F1)
subset_F1['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_F1['Hier'] <- c(rep("F", times = 64))
subset_F1['Comp'] <- c(rep("1", times = 64))
subset_F1['Condition'] <- c(rep("F1", times = 64))
for (i in 65:128){
sub_F$condition[sub_F$trial_number == i] = "F2"
}
subset_F2 <- subset(sub_F, sub_F$condition == "F2")
subset_F2 <- as.data.frame(subset_F2)
subset_F2['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_F2['Hier'] <- c(rep("F", times = 64))
subset_F2['Comp'] <- c(rep("2", times = 64))
subset_F2['Condition'] <- c(rep("F2", times = 64))
for (i in 129:192){
sub_F$condition[sub_F$trial_number == i] = "F4"
}
subset_F4 <- subset(sub_F, sub_F$condition == "F4")
subset_F4 <- as.data.frame(subset_F4)
subset_F4['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_F4['Hier'] <- c(rep("F", times = 64))
subset_F4['Comp'] <- c(rep("4", times = 64))
subset_F4['Condition'] <- c(rep("F4", times = 64))
subset_F <- rbind(subset_F1, subset_F2, subset_F4)
subtmp3=subset(data_RFD,sheet==3, select = c(Subject, Onset, Code, Acc))
subtmp3 = subtmp3 %>% filter(Code != 99)
sub_D <- as.data.table(subtmp3)
sub_D[, inter_RT :=   Onset - shift(Onset, fill=last(Onset))]
RT=subset(sub_D, select = c(inter_RT))
RT <- RT[-1,]
sub_D <- head(sub_D, -1)
sub_D[, RT :=  RT]
t = as.numeric(substr(sub_D$Code, 9,11))
sub_D[, trial_number :=  t]
for (i in 1:64){
sub_D$condition[sub_D$trial_number == i] = "D1"
}
subset_D1 <- subset(sub_D, sub_D$condition == "D1")
subset_D1 <- as.data.frame(subset_D1)
subset_D1['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_D1['Hier'] <- c(rep("D", times = 64))
subset_D1['Comp'] <- c(rep("1", times = 64))
subset_D1['Condition'] <- c(rep("D1", times = 64))
for (i in 65:128){
sub_D$condition[sub_D$trial_number == i] = "D2"
}
subset_D2 <- subset(sub_D, sub_D$condition == "D2")
subset_D2 <- as.data.frame(subset_D2)
subset_D2['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_D2['Hier'] <- c(rep("D", times = 64))
subset_D2['Comp'] <- c(rep("2", times = 64))
subset_D2['Condition'] <- c(rep("D2", times = 64))
for (i in 129:192){
sub_D$condition[sub_D$trial_number == i] = "D4"
}
subset_D4 <- subset(sub_D, sub_D$condition == "D4")
subset_D4 <- as.data.frame(subset_D4)
subset_D4['Subject'] <- c(rep(sprintf("%s", sub[s]), 64))
subset_D4['Hier'] <- c(rep("D", times = 64))
subset_D4['Comp'] <- c(rep("4", times = 64))
subset_D4['Condition'] <- c(rep("D4", times = 64))
subset_D <- rbind(subset_D1, subset_D2, subset_D4)
data_sub <- rbind(subset_R, subset_F, subset_D)
data_sub <- subset(data_sub, select = c(Subject, Hier, Comp, Condition, Acc, RT))
data_sub <- mutate(data_sub, Acc = if_else(Acc == "hit", 100, 0))
for (k in 1:length(data_sub$RT)){
data_sub$RT[k] = data_sub$RT[k]/10
}
data_total <- rbind(data_total, data_sub)
}
gc()
